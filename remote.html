<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4CAF50">
    <title>Puzzel Remote - Ouder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            width: 100%;
            min-height: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%);
            user-select: none;
            -webkit-user-select: none;
        }

        .container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 400px;
            width: 100%;
            margin-bottom: 15px;
        }

        h1 {
            font-size: 22px;
            color: #333;
            margin-bottom: 8px;
        }

        h2 {
            font-size: 18px;
            color: #333;
            margin-bottom: 15px;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
            margin-bottom: 20px;
        }

        /* Connect Screen */
        .code-input-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .code-digit {
            width: 50px;
            height: 60px;
            font-size: 28px;
            text-align: center;
            border: 3px solid #ddd;
            border-radius: 12px;
            font-weight: bold;
            color: #333;
        }

        .code-digit:focus {
            border-color: #4CAF50;
            outline: none;
        }

        .connect-btn {
            width: 100%;
            padding: 18px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 15px;
            background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%);
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        .connect-btn:active {
            transform: scale(0.98);
        }

        .connect-btn:disabled {
            background: #ccc;
            box-shadow: none;
        }

        .error-msg {
            color: #f44336;
            font-size: 14px;
            margin-top: 15px;
            display: none;
        }

        /* Connected Screen */
        .connected-screen {
            display: none;
        }

        .status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
            color: #4CAF50;
            font-weight: 600;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            background: #4CAF50;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        /* Main Piece Button */
        .piece-btn {
            width: 100%;
            padding: 30px 20px;
            font-size: 22px;
            font-weight: bold;
            border: none;
            border-radius: 20px;
            background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
            color: white;
            cursor: pointer;
            box-shadow: 0 6px 25px rgba(255, 107, 107, 0.4);
            margin-bottom: 15px;
            transition: transform 0.1s;
        }

        .piece-btn:active {
            transform: scale(0.95);
        }

        .piece-btn.success {
            background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%);
        }

        .piece-btn .emoji {
            font-size: 40px;
            display: block;
            margin-bottom: 8px;
        }

        /* Navigation Buttons */
        .nav-btn {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .nav-btn:active {
            transform: scale(0.98);
        }

        .nav-btn.tasks { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .nav-btn.settings { background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%); }
        .nav-btn.puzzles { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }

        .disconnect-btn {
            margin-top: 10px;
            padding: 12px 25px;
            font-size: 14px;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: white;
            color: #666;
            cursor: pointer;
        }

        /* Settings Screen */
        .settings-screen {
            display: none;
        }

        .setting-item {
            margin-bottom: 20px;
            text-align: left;
        }

        .setting-item label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .setting-item input[type="range"] {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            background: #ddd;
            border-radius: 4px;
            outline: none;
        }

        .setting-item input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: #4CAF50;
            border-radius: 50%;
            cursor: pointer;
        }

        .setting-item input[type="number"] {
            width: 80px;
            padding: 10px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            text-align: center;
        }

        .setting-item select {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
        }

        .toggle-btn {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            font-weight: 600;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: white;
            cursor: pointer;
        }

        .toggle-btn.active {
            background: #4CAF50;
            border-color: #4CAF50;
            color: white;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .action-btn {
            padding: 15px 10px;
            font-size: 14px;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        .action-btn.reset { background: #f44336; }
        .action-btn.next { background: #2196F3; }
        .action-btn.pause { background: #FF9800; }
        .action-btn.resume { background: #4CAF50; }

        /* Tasks Screen */
        .tasks-screen {
            display: none;
        }

        .task-categories {
            max-height: 50vh;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .category {
            margin-bottom: 12px;
        }

        .category-title {
            font-size: 15px;
            font-weight: bold;
            color: #333;
            padding: 12px;
            background: #f5f5f5;
            border-radius: 10px;
            margin-bottom: 6px;
            cursor: pointer;
        }

        .category-title:active {
            background: #e0e0e0;
        }

        .category-tasks {
            display: none;
            flex-direction: column;
            gap: 6px;
        }

        .category-tasks.open {
            display: flex;
        }

        .task-item {
            padding: 12px 15px;
            font-size: 14px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
            color: white;
            cursor: pointer;
            text-align: left;
            font-weight: 500;
        }

        .task-item:active {
            transform: scale(0.98);
            opacity: 0.9;
        }

        .task-item.success {
            background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%);
        }

        /* Puzzles Screen */
        .puzzles-screen {
            display: none;
        }

        .puzzle-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            max-height: 50vh;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .puzzle-item {
            padding: 15px 10px;
            font-size: 12px;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            text-align: center;
        }

        .puzzle-item:active {
            transform: scale(0.95);
        }

        .puzzle-item .emoji {
            font-size: 28px;
            display: block;
            margin-bottom: 5px;
        }

        /* Back Button */
        .back-btn {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            font-weight: 600;
            border: 2px solid #ddd;
            border-radius: 12px;
            background: white;
            color: #666;
            cursor: pointer;
        }

        .back-btn:active {
            background: #f5f5f5;
        }

        .instructions {
            margin-top: 15px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 10px;
            font-size: 13px;
            color: #666;
            line-height: 1.5;
        }

        .instructions strong {
            color: #333;
        }

        .version-info {
            text-align: center;
            margin-top: 10px;
            font-size: 12px;
            color: rgba(255,255,255,0.7);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Connect Screen -->
        <div class="card connect-screen" id="connect-screen">
            <h1>ğŸ® Puzzel Remote</h1>
            <p class="subtitle">Verbind met de tablet van je kind</p>

            <div class="code-input-container">
                <input type="tel" class="code-digit" maxlength="1" id="digit1" inputmode="numeric" pattern="[0-9]">
                <input type="tel" class="code-digit" maxlength="1" id="digit2" inputmode="numeric" pattern="[0-9]">
                <input type="tel" class="code-digit" maxlength="1" id="digit3" inputmode="numeric" pattern="[0-9]">
                <input type="tel" class="code-digit" maxlength="1" id="digit4" inputmode="numeric" pattern="[0-9]">
            </div>

            <button class="connect-btn" id="connect-btn" disabled>Verbinden</button>

            <p class="error-msg" id="error-msg"></p>

            <div class="instructions">
                <strong>Hoe werkt het?</strong><br>
                1. Open de app op de tablet<br>
                2. De code verschijnt automatisch in de console (F12)<br>
                3. Voer de 4-cijferige code hier in
            </div>
        </div>

        <!-- Connected Screen (Main Menu) -->
        <div class="card connected-screen" id="connected-screen">
            <h1>ğŸ® Verbonden!</h1>

            <div class="status">
                <div class="status-dot"></div>
                <span>Verbonden met tablet</span>
            </div>

            <button class="piece-btn" id="piece-btn">
                <span class="emoji">ğŸ§©</span>
                Stukje Geven!
            </button>

            <button class="nav-btn tasks" id="show-tasks-btn">ğŸ“‹ Taken Kiezen</button>
            <button class="nav-btn settings" id="show-settings-btn">âš™ï¸ Instellingen</button>
            <button class="nav-btn puzzles" id="show-puzzles-btn">ğŸ§© Andere Puzzel</button>

            <button class="disconnect-btn" id="disconnect-btn">Verbinding verbreken</button>
        </div>

        <!-- Settings Screen -->
        <div class="card settings-screen" id="settings-screen">
            <h2>âš™ï¸ Instellingen</h2>

            <div class="setting-item">
                <label>ğŸ”Š Volume: <span id="volume-value">50</span>%</label>
                <input type="range" id="volume-slider" min="0" max="100" value="50">
            </div>

            <div class="setting-item">
                <label>ğŸ”‡ Geluid</label>
                <button class="toggle-btn active" id="sound-toggle">ğŸ”Š Aan</button>
            </div>

            <div class="setting-item">
                <label>â±ï¸ Minuten per stukje:</label>
                <input type="number" id="timer-interval" min="1" max="60" value="15">
            </div>

            <div class="setting-item">
                <label>ğŸ§© Aantal stukjes:</label>
                <select id="piece-count">
                    <option value="12">12 stukjes (3x4)</option>
                    <option value="20">20 stukjes (4x5)</option>
                    <option value="30">30 stukjes (5x6)</option>
                    <option value="40" selected>40 stukjes (5x8)</option>
                    <option value="60">60 stukjes (6x10)</option>
                </select>
            </div>

            <div class="setting-item">
                <label>ğŸš— Voertuig:</label>
                <select id="vehicle-select">
                    <option value="ğŸš—">ğŸš— Auto</option>
                    <option value="ğŸšŒ">ğŸšŒ Bus</option>
                    <option value="ğŸš‚">ğŸš‚ Trein</option>
                    <option value="âœˆï¸">âœˆï¸ Vliegtuig</option>
                    <option value="ğŸš¢">ğŸš¢ Boot</option>
                    <option value="ğŸš²">ğŸš² Fiets</option>
                    <option value="ğŸï¸">ğŸï¸ Raceauto</option>
                    <option value="ğŸš€">ğŸš€ Raket</option>
                </select>
            </div>

            <div class="action-buttons">
                <button class="action-btn pause" id="pause-btn">â¸ï¸ Pauze</button>
                <button class="action-btn reset" id="reset-btn">ğŸ”„ Reset</button>
            </div>

            <button class="back-btn" id="settings-back-btn">â† Terug</button>
        </div>

        <!-- Tasks Screen -->
        <div class="card tasks-screen" id="tasks-screen">
            <h2>ğŸ“‹ Kies een Taak</h2>
            <p class="subtitle">Tik op een taak als je kind het heeft gedaan</p>

            <div class="task-categories" id="task-categories">
                <!-- Categories will be populated by JS -->
            </div>

            <button class="back-btn" id="tasks-back-btn">â† Terug</button>
        </div>

        <!-- Puzzles Screen -->
        <div class="card puzzles-screen" id="puzzles-screen">
            <h2>ğŸ§© Kies een Puzzel</h2>

            <div class="puzzle-grid" id="puzzle-grid">
                <!-- Puzzles will be populated by JS -->
            </div>

            <button class="back-btn" id="puzzles-back-btn">â† Terug</button>
        </div>

        <div class="version-info">v2.1.0</div>
    </div>

    <script src="src/js/firebase-config.js"></script>
    <script src="src/js/remote.js"></script>
    <script>
        // 60+ taken voor 2-jarigen tijdens een autorit
        const remoteTasks = {
            "ğŸµ Zingen & Geluid": [
                "ğŸµ Een liedje gezongen",
                "ğŸ‘ In de handen geklapt",
                "ğŸ® Koe-geluid gemaakt (boe!)",
                "ğŸ· Varken-geluid gemaakt (knor!)",
                "ğŸ¶ Hond-geluid gemaakt (waf!)",
                "ğŸ± Kat-geluid gemaakt (miauw!)",
                "ğŸ¦ Leeuw-geluid gemaakt (roar!)",
                "ğŸ¸ Kikker-geluid gemaakt (kwaak!)",
                "ğŸ¦ Vogel-geluid gemaakt (tjilp!)",
                "ğŸš— Auto-geluid gemaakt (broem!)"
            ],
            "ğŸ‘€ Kijken & Zoeken": [
                "ğŸš— Een rode auto gezien",
                "ğŸš™ Een blauwe auto gezien",
                "ğŸš• Een gele auto gezien",
                "ğŸšš Een vrachtwagen gezien",
                "ğŸšŒ Een bus gezien",
                "ğŸš’ Een brandweerauto gezien",
                "ğŸš‘ Een ambulance gezien",
                "ğŸšœ Een tractor gezien",
                "ğŸ„ Een koe gezien",
                "ğŸ‘ Een schaap gezien",
                "ğŸ´ Een paard gezien",
                "ğŸ¦† Een eend gezien",
                "ğŸ¦ Een vogel gezien",
                "ğŸŒ³ Een grote boom gezien",
                "ğŸ’§ Water gezien (sloot/rivier)",
                "ğŸŒˆ Een regenboog gezien",
                "â˜€ï¸ De zon gezien",
                "â˜ï¸ Een wolk aangewezen"
            ],
            "ğŸ¤¸ Beweging": [
                "ğŸ‘‹ Gezwaaid",
                "ğŸ‘ Duimpje omhoog gedaan",
                "âœ‹ High five gegeven",
                "ğŸ¦¶ Met voetjes gestampt",
                "ğŸ™† Armen omhoog gedaan",
                "ğŸ‘ƒ Neus aangeraakt",
                "ğŸ‘‚ Oren aangeraakt",
                "ğŸ‘€ Ogen dichtgedaan",
                "ğŸ˜› Tong uitgestoken",
                "ğŸ¤— Knuffel gegeven"
            ],
            "ğŸ”¢ Tellen & Leren": [
                "1ï¸âƒ£ Tot 3 geteld",
                "âœŒï¸ 2 vingers opgestoken",
                "ğŸ–ï¸ 5 vingers laten zien",
                "ğŸ”´ Iets roods aangewezen",
                "ğŸ”µ Iets blauws aangewezen",
                "ğŸŸ¢ Iets groens aangewezen",
                "ğŸŸ¡ Iets geels aangewezen",
                "âš« Iets zwarts aangewezen",
                "âšª Iets wits aangewezen"
            ],
            "ğŸ Eten & Drinken": [
                "ğŸ§ƒ Wat gedronken",
                "ğŸª Een koekje gegeten",
                "ğŸ Fruit gegeten",
                "ğŸ¥ª Broodje gegeten",
                "ğŸŒ Banaan gegeten"
            ],
            "ğŸ˜Š Braaf Zijn": [
                "ğŸ˜Š Lief gelachen",
                "ğŸ¤« Even stil geweest",
                "ğŸª‘ Rustig blijven zitten",
                "ğŸ‘¶ Lief geweest",
                "ğŸ˜´ Even geslapen",
                "ğŸ“– Naar een boekje gekeken",
                "ğŸ§¸ Met knuffel gespeeld",
                "ğŸ¨ Getekend/gekleurd"
            ]
        };

        // Puzzle list (matching tablet)
        const puzzleList = [
            { name: 'Dierentuin', emoji: 'ğŸ¦', color: '#87CEEB' },
            { name: 'Boerderij', emoji: 'ğŸ„', color: '#87CEEB' },
            { name: 'Kermis', emoji: 'ğŸ¡', color: '#FF69B4' },
            { name: 'Onderwaterwereld', emoji: 'ğŸ ', color: '#00CED1' },
            { name: 'Stad', emoji: 'ğŸ™ï¸', color: '#87CEEB' },
            { name: 'Supermarkt', emoji: 'ğŸ›’', color: '#FFE4B5' },
            { name: 'Speeltuin', emoji: 'ğŸ›', color: '#87CEEB' },
            { name: 'Bos', emoji: 'ğŸŒ²', color: '#228B22' },
            { name: 'Strand', emoji: 'ğŸ–ï¸', color: '#87CEEB' },
            { name: 'Ruimte', emoji: 'ğŸš€', color: '#000033' },
            { name: 'Feestje', emoji: 'ğŸ‚', color: '#FF69B4' },
            { name: 'Treinstation', emoji: 'ğŸš‚', color: '#87CEEB' },
            { name: 'Vliegveld', emoji: 'âœˆï¸', color: '#87CEEB' },
            { name: 'Camping', emoji: 'â›º', color: '#228B22' },
            { name: 'Sneeuwpret', emoji: 'â›·ï¸', color: '#B0E0E6' },
            { name: 'Jungle', emoji: 'ğŸ¦œ', color: '#228B22' },
            { name: 'Circus', emoji: 'ğŸª', color: '#FF4500' },
            { name: 'Restaurant', emoji: 'ğŸ•', color: '#FFDAB9' },
            { name: 'Muziek', emoji: 'ğŸ¸', color: '#9370DB' },
            { name: 'Tuin', emoji: 'ğŸŒ·', color: '#87CEEB' },
            { name: 'Sportveld', emoji: 'âš½', color: '#228B22' },
            { name: 'Kasteel', emoji: 'ğŸ°', color: '#87CEEB' },
            { name: 'Piraten', emoji: 'ğŸ´â€â˜ ï¸', color: '#87CEEB' },
            { name: 'Bouwplaats', emoji: 'ğŸ—ï¸', color: '#87CEEB' }
        ];
    </script>
    <script>
        // State
        let isPaused = false;
        let soundEnabled = true;

        // Elements
        const connectScreen = document.getElementById('connect-screen');
        const connectedScreen = document.getElementById('connected-screen');
        const settingsScreen = document.getElementById('settings-screen');
        const tasksScreen = document.getElementById('tasks-screen');
        const puzzlesScreen = document.getElementById('puzzles-screen');

        const connectBtn = document.getElementById('connect-btn');
        const errorMsg = document.getElementById('error-msg');
        const pieceBtn = document.getElementById('piece-btn');
        const disconnectBtn = document.getElementById('disconnect-btn');

        const digits = [
            document.getElementById('digit1'),
            document.getElementById('digit2'),
            document.getElementById('digit3'),
            document.getElementById('digit4')
        ];

        // Screen navigation
        function showScreen(screen) {
            connectScreen.style.display = 'none';
            connectedScreen.style.display = 'none';
            settingsScreen.style.display = 'none';
            tasksScreen.style.display = 'none';
            puzzlesScreen.style.display = 'none';
            screen.style.display = 'block';
        }

        // Populate task categories
        function populateTaskCategories() {
            const container = document.getElementById('task-categories');
            container.innerHTML = '';

            for (const [categoryName, tasks] of Object.entries(remoteTasks)) {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';

                const titleDiv = document.createElement('div');
                titleDiv.className = 'category-title';
                titleDiv.textContent = categoryName;

                const tasksDiv = document.createElement('div');
                tasksDiv.className = 'category-tasks';

                tasks.forEach(task => {
                    const taskBtn = document.createElement('button');
                    taskBtn.className = 'task-item';
                    taskBtn.textContent = task;
                    taskBtn.addEventListener('click', () => sendTaskPiece(taskBtn));
                    tasksDiv.appendChild(taskBtn);
                });

                titleDiv.addEventListener('click', () => {
                    tasksDiv.classList.toggle('open');
                });

                categoryDiv.appendChild(titleDiv);
                categoryDiv.appendChild(tasksDiv);
                container.appendChild(categoryDiv);
            }
        }

        // Populate puzzle grid
        function populatePuzzleGrid() {
            const container = document.getElementById('puzzle-grid');
            container.innerHTML = '';

            puzzleList.forEach((puzzle, index) => {
                const btn = document.createElement('button');
                btn.className = 'puzzle-item';
                btn.style.background = puzzle.color;
                btn.innerHTML = `<span class="emoji">${puzzle.emoji}</span>${puzzle.name}`;
                btn.addEventListener('click', () => selectPuzzle(index));
                container.appendChild(btn);
            });
        }

        // Send piece for a task
        async function sendTaskPiece(btn) {
            try {
                btn.classList.add('success');
                await RemoteControl.sendPiece();

                setTimeout(() => {
                    btn.classList.remove('success');
                }, 500);
            } catch (error) {
                alert('Verzenden mislukt: ' + error.message);
            }
        }

        // Select a puzzle
        async function selectPuzzle(index) {
            try {
                await sendSettings({ changePuzzle: index });
                showScreen(connectedScreen);
            } catch (error) {
                alert('Fout: ' + error.message);
            }
        }

        // Send settings to tablet
        async function sendSettings(settings) {
            if (!RemoteControl.roomRef) {
                throw new Error('Niet verbonden');
            }

            await RemoteControl.roomRef.child('settings').update({
                ...settings,
                timestamp: Date.now()
            });
        }

        // Auto-focus and move between digits
        digits.forEach((digit, index) => {
            digit.addEventListener('input', (e) => {
                const value = e.target.value.replace(/\D/g, '');
                e.target.value = value.slice(-1);

                if (value && index < 3) {
                    digits[index + 1].focus();
                }

                updateConnectButton();
            });

            digit.addEventListener('keydown', (e) => {
                if (e.key === 'Backspace' && !e.target.value && index > 0) {
                    digits[index - 1].focus();
                }
            });

            digit.addEventListener('paste', (e) => {
                e.preventDefault();
                const paste = (e.clipboardData || window.clipboardData).getData('text');
                const numbers = paste.replace(/\D/g, '').slice(0, 4);
                numbers.split('').forEach((num, i) => {
                    if (digits[i]) digits[i].value = num;
                });
                if (numbers.length === 4) digits[3].focus();
                updateConnectButton();
            });
        });

        function updateConnectButton() {
            const code = digits.map(d => d.value).join('');
            connectBtn.disabled = code.length !== 4;
        }

        function getCode() {
            return digits.map(d => d.value).join('');
        }

        // Connect button
        connectBtn.addEventListener('click', async () => {
            const code = getCode();
            connectBtn.disabled = true;
            connectBtn.textContent = 'Verbinden...';
            errorMsg.style.display = 'none';

            try {
                await RemoteControl.joinRoom(code);
                showScreen(connectedScreen);
                populateTaskCategories();
                populatePuzzleGrid();
            } catch (error) {
                errorMsg.textContent = error.message || 'Verbinding mislukt';
                errorMsg.style.display = 'block';
                connectBtn.disabled = false;
                connectBtn.textContent = 'Verbinden';
            }
        });

        // Send piece
        async function sendPiece(btn) {
            try {
                btn.classList.add('success');
                await RemoteControl.sendPiece();

                setTimeout(() => {
                    btn.classList.remove('success');
                }, 500);
            } catch (error) {
                alert('Verzenden mislukt: ' + error.message);
            }
        }

        pieceBtn.addEventListener('click', () => sendPiece(pieceBtn));

        // Navigation buttons
        document.getElementById('show-tasks-btn').addEventListener('click', () => {
            showScreen(tasksScreen);
        });

        document.getElementById('show-settings-btn').addEventListener('click', () => {
            showScreen(settingsScreen);
        });

        document.getElementById('show-puzzles-btn').addEventListener('click', () => {
            showScreen(puzzlesScreen);
        });

        // Back buttons
        document.getElementById('tasks-back-btn').addEventListener('click', () => {
            showScreen(connectedScreen);
        });

        document.getElementById('settings-back-btn').addEventListener('click', () => {
            showScreen(connectedScreen);
        });

        document.getElementById('puzzles-back-btn').addEventListener('click', () => {
            showScreen(connectedScreen);
        });

        // Settings handlers
        document.getElementById('volume-slider').addEventListener('input', async (e) => {
            const value = e.target.value;
            document.getElementById('volume-value').textContent = value;
            await sendSettings({ volume: parseInt(value) });
        });

        document.getElementById('sound-toggle').addEventListener('click', async (e) => {
            soundEnabled = !soundEnabled;
            e.target.textContent = soundEnabled ? 'ğŸ”Š Aan' : 'ğŸ”‡ Uit';
            e.target.classList.toggle('active', soundEnabled);
            await sendSettings({ soundEnabled });
        });

        document.getElementById('timer-interval').addEventListener('change', async (e) => {
            const value = parseInt(e.target.value);
            if (value >= 1 && value <= 60) {
                await sendSettings({ timerInterval: value });
            }
        });

        document.getElementById('piece-count').addEventListener('change', async (e) => {
            await sendSettings({ pieceCount: parseInt(e.target.value) });
        });

        document.getElementById('vehicle-select').addEventListener('change', async (e) => {
            await sendSettings({ vehicle: e.target.value });
        });

        document.getElementById('pause-btn').addEventListener('click', async (e) => {
            isPaused = !isPaused;
            e.target.textContent = isPaused ? 'â–¶ï¸ Doorgaan' : 'â¸ï¸ Pauze';
            e.target.className = isPaused ? 'action-btn resume' : 'action-btn pause';
            await sendSettings({ timerPaused: isPaused });
        });

        document.getElementById('reset-btn').addEventListener('click', async () => {
            if (confirm('Weet je zeker dat je de puzzel wilt resetten?')) {
                await sendSettings({ resetPuzzle: true });
            }
        });

        // Disconnect
        disconnectBtn.addEventListener('click', () => {
            RemoteControl.disconnect();
            showScreen(connectScreen);
            digits.forEach(d => d.value = '');
            updateConnectButton();
        });

        // Focus first digit on load
        digits[0].focus();
    </script>
</body>
</html>
